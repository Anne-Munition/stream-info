FROM node:16.13.2-alpine3.15 as base
RUN apk add --no-cache graphicsmagick
WORKDIR /app

FROM base AS backend_prod_dependencies
COPY ./backend .
RUN yarn --production=true

FROM backend_prod_dependencies as backend_builder
RUN yarn --production=false
RUN yarn prettier
RUN yarn lint
RUN yarn test
RUN yarn build

# This docker image is merged with the frontend in CI
